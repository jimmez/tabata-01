<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tabata Timer</title>
  <style>
    body {
      margin:0; font-family: sans-serif; text-align:center;
      background:black; color:white;
    }
    .clock { font-size: 80px; margin: 20px 0; }
    .phase { font-size: 28px; font-weight: bold; margin: 10px 0; }
    .rep { font-size: 50px; opacity:.5; margin: 6px 0; }
    .btn {
      font-size: 24px; padding: 14px 22px; margin: 6px;
      border:none; border-radius:12px; cursor:pointer;
    }
    .btn.active { background: lightblue; }
    .hint { font-size: 14px; opacity:.8; margin-top: 4px; }
    .footer {
      position:fixed; bottom:0; left:0; right:0;
      background:rgba(0,0,0,.35); font-size:12px;
      padding:8px;
    }
    .progress {
      position:fixed; bottom:0; left:0; right:0;
      height:6vh; background:green; z-index:0;
    }
  </style>
</head>
<body>
  <div class="progress" id="progress"></div>

  <div id="app">
    <div class="phase" id="phase">Work</div>
    <div class="rep" id="rep">1</div>
    <div class="clock" id="clock">00:00</div>

    <div>
      <button id="startBtn" class="btn">▶️ Start / Cont</button>
      <button id="pauseBtn" class="btn">⏸ Pause</button>
      <div class="hint">Pause button → stop the clock</div>
      <button id="resetBtn" class="btn">⏹ Reset</button>
      <div class="hint">Reset: 1 tap → next phase, 2 taps → restart current phase</div>
    </div>
  </div>

  <div class="footer">Jimmy James - 16.08.2025 - 15:45 - v. 1.06</div>

  <script>
    const phaseEl = document.getElementById('phase');
    const clockEl = document.getElementById('clock');
    const repEl = document.getElementById('rep');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const progress = document.getElementById('progress');

    let work = 20, rest = 10;
    let rep = 1, phase = 'work';
    let running=false, startTs=0, elapsed=0;
    let rafId=null, lastTap=0;

    function secsToMMSS(s){
      let m=Math.floor(s/60), ss=s%60;
      return String(m).padStart(2,'0')+':'+String(ss).padStart(2,'0');
    }

    function updateDisplay(){
      const total = phase==='work'?work:rest;
      const shown = Math.floor(elapsed);
      clockEl.textContent = secsToMMSS(shown);
      repEl.textContent = rep;
      phaseEl.textContent = phase==='work'?'Work':'Rest';
      if(phase==='work'){
        document.body.style.background='black';
        progress.style.background='green';
      } else {
        document.body.style.background='#8b1e5d';
        progress.style.background='red';
      }
      if(!running && elapsed>0){
        document.body.style.background='skyblue';
      }
      let frac = total>0 ? Math.min(elapsed/total,1):1;
      progress.style.height = (Math.max(6, frac*100))+'vh';
    }

    function loop(){
      if(!running) return;
      const now=performance.now();
      elapsed=(now-startTs)/1000;
      const total = phase==='work'?work:rest;
      if(elapsed>=total){ nextPhase(); }
      updateDisplay();
      rafId=requestAnimationFrame(loop);
    }

    function start(){
      if(running) return;
      running=true;
      startTs=performance.now()-elapsed*1000;
      loop();
    }
    function pause(){
      running=false;
      if(rafId) cancelAnimationFrame(rafId);
      rafId=null;
      updateDisplay();
    }
    function resetPhaseOnly(){
      const wasRunning=running;
      pause(); elapsed=0; startTs=performance.now();
      updateDisplay();
      if(wasRunning) start();
    }
    function nextPhase(){
      const wasRunning=running;
      pause();
      if(phase==='work'){phase='rest';}
      else {phase='work';rep++;}
      elapsed=0; startTs=performance.now();
      updateDisplay();
      if(wasRunning) start();
    }

    startBtn.onclick=()=>{ start(); startBtn.classList.add('active'); pauseBtn.classList.remove('active'); };
    pauseBtn.onclick=()=>{ pause(); pauseBtn.classList.add('active'); startBtn.classList.remove('active'); };
    resetBtn.onclick=()=>{
      const now=Date.now();
      if(now-lastTap<350){ resetPhaseOnly(); lastTap=0; }
      else { nextPhase(); lastTap=now; }
    };

    updateDisplay();
  </script>
</body>
</html>
